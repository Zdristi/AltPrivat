# Настройка и запуск Telegram бота

## Подготовка

1. Установите Python 3.7 или выше
2. Получите токен для бота у @BotFather в Telegram
3. Настройте платежный провайдер у @BotFather (для оплаты рублями)
4. Получите токен у @CryptoBot (для криптоплатежей)
5. Создайте или подготовьте приватный Telegram канал

## Установка

1. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```

2. Настройте переменные окружения:
   - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
   - `PAYMENT_PROVIDER_TOKEN` - токен платежного провайдера (для оплаты рублями)
   - `CRYPTO_BOT_TOKEN` - токен от CryptoBot (для криптоплатежей)
   - `CHANNEL_ID` - ID или имя вашего приватного канала

   В Windows:
   ```
   set TELEGRAM_BOT_TOKEN=ваш_токен_бота
   set PAYMENT_PROVIDER_TOKEN=ваш_токен_платежа
   set CRYPTO_BOT_TOKEN=ваш_токен_cryptobot
   set CHANNEL_ID=@имя_вашего_канала
   ```

   В Linux/Mac:
   ```
   export TELEGRAM_BOT_TOKEN=ваш_токен_бота
   export PAYMENT_PROVIDER_TOKEN=ваш_токен_платежа
   export CRYPTO_BOT_TOKEN=ваш_токен_cryptobot
   export CHANNEL_ID=@имя_вашего_канала
   ```

   Или измените значения в файле `config.py` напрямую

3. Запустите бота:
   - Для оплаты рублями: `python bot.py`
   - Для оплаты криптовалютой: `python cryptobot.py`
   - Для обоих способов оплаты: `python universal_bot.py`

## Альтернативный способ запуска с виртуальным окружением

1. Запустите setup.bat (для Windows):
   ```
   setup.bat
   ```

2. После установки активируйте виртуальное окружение:
   ```
   venv\Scripts\activate
   ```

3. Настройте переменные окружения как описано выше

4. Запустите бота:
   ```
   python universal_bot.py
   ```

## Тестирование платежей

Telegram предоставляет тестовые платежные токены для разработчиков:
- Для тестирования используйте тестовый платежный токен от @BotFather
- В тестовом режиме вы можете использовать номер карты 1111 1111 1111 1111 для симуляции успешных платежей

Для криптоплатежей:
- Используйте токен от @CryptoBot
- Вы можете протестировать с реальной криптовалютой на небольших суммах

## Управление подписками

Для управления подписками пользователей используйте db_manager.py:
```
python db_manager.py
```

Доступные команды:
- `view` - посмотреть всех пользователей
- `check <user_id>` - проверить статус подписки пользователя
- `add <user_id> [days]` - добавить/обновить подписку пользователя
- `remove <user_id>` - удалить пользователя из базы данных

## Технические детали

- Бот использует библиотеку aiogram для взаимодействия с Telegram API
- Данные пользователей хранятся в локальной SQLite базе данных (users.db)
- При успешной оплате в базу заносится ID пользователя и дата окончания подписки
- При каждом запуске команды /start или попытке покупки проверяется статус подписки
- Поддерживается как рублевая, так и криптовалютная система оплаты